---
title: "RNAseq Post Analysis Visualization"
author: "Evan Udine"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document: 
   code_folding: show
   toc: true
   toc_float: true
   smooth_scroll: true
   number_sections: false
   self_contained: true
---
#Set Up
##Libraries
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
sessionInfo()
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(ggrepel))
suppressPackageStartupMessages(library(ggfortify))
suppressPackageStartupMessages(library(gplots))
suppressPackageStartupMessages(library(RColorBrewer))
```

#Distributions
```{r Distributions}
res = read.table("/sc/hydra/projects/pd-omics/evan/MyND-Analysis/data/results/rsem.mynd.dte.txt", header = T)
head(res)
p = ggplot(res, aes(P.Value))
p + geom_density(color="darkblue", fill="lightblue") + theme_bw() + ggtitle("P Value Distribution")

p = ggplot(res, aes(adj.P.Val))
p + geom_density(color="darkblue", fill="lightblue") + theme_bw() + ggtitle("FDR Distribution")

p = ggplot(res, aes(logFC))
p + geom_density(color="darkblue", fill="lightblue") + theme_bw() + ggtitle("Fold Change Distribution")
```

#DE Plots
```{r DE Plots}
plot.data = res
head(plot.data)
plot.data$id = rownames(plot.data)
data = data.frame(plot.data)
data$P.Value = -log10(data$P.Value)
head(data)
table(res$adj.P.Val < .05)
data$fifteen = as.factor(abs(data$adj.P.Val < 0.05))
data = data[order(-data$adj.P.Val),]
#MA Plot
pdf('madte.pdf')
ma = ggplot(data, aes(AveExpr, logFC, colour = fifteen))
ma + geom_point() +
  scale_color_manual(values = c("black", "red"), labels = c(" > 0.05", "< 0.05")) +
  labs(title = "MA Plot", color = "FDR") + theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) + ylim(-3, 3) + xlim(-4, 14)
dev.off()

pdf('vpdte.pdf')
#Volcano Plot
vp = ggplot(data, aes(logFC, P.Value, colour = fifteen))
vp + geom_point() +
  scale_color_manual(values = c("gray", "red"), labels = c("> 0.05", "< 0.05")) + 
  labs(title = "Gene Level Volcano Plot", color = "FDR") +
  theme(plot.title = element_text(hjust = 0.5)) + theme_bw() +
  xlim(-2.5,2.5) + ylim(0,10) + ylab("-log10 pvalue")
dev.off()
ann = read.table('/sc/hydra/projects/pd-omics/GRCH38.p12/ens.txid.gencode.v30', row.names = 1,  header = T, check.names = F)
head(ann)

merged_ann = merge(res, ann, by  = 0, sort = F)
head(merged_ann)

write.table(merged_ann, "monocytes_dte_rsem.txt", sep = "\t", quote = F, row.names = F)
```
